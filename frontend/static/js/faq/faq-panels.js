(function(){const canvas=document.getElementById('faq-panels');if(!canvas)return;const ctx=canvas.getContext('2d');let W,H,fragments,running=false,animId;const FRAG_COUNT=55;const FRAME_MS=42;let lastFrame=0;const CODE_SNIPPETS=['01001010','11010011','10110100','00101101','01110010','11001001','10010110','01101011','00110011','11100101','01011100','10001110','0x4F49','0xDEAD','0xBEEF','0xCAFE','0xFF','0x00','0xA3B7','<div>','</div>','<span/>','<code/>','<init>','</>','<App />','<main>','const','let','var','return','async','await','import','export','function','class','extends','new','if','else','for','while','try','catch','throw','finally','null','undefined','void','typeof','true','false','this','super','=> {','...args','?.','??','===','!==','&&','||','[ ]','{ }','( )',';','console.log()','.map()','.filter()','.reduce()','.forEach()','.push()','fetch()','JSON.parse()','Promise.all()','useState()','useEffect()','require()','// TODO','/* */','npm install','git commit','git push','node index.js','python main.py','docker run','ssh root@',];function getColor(text){if(/^[01]+$/.test(text)||text.startsWith('0x'))
return{r:34,g:211,b:238};if(text.startsWith('<')||text.startsWith('</'))
return{r:244,g:114,b:182};if(/^(const|let|var|return|async|await|import|export|function|class|extends|new|if|else|for|while|try|catch|throw|finally|null|undefined|void|typeof|true|false|this|super)$/.test(text))
return{r:139,g:92,b:246};if(text.startsWith('.')||text.includes('('))
return{r:52,g:211,b:153};if(text.startsWith('//')||text.startsWith('/*'))
return{r:100,g:116,b:139};return{r:226,g:232,b:240};}
function resize(){W=canvas.width=window.innerWidth;H=canvas.height=window.innerHeight;}
function createFragments(){fragments=[];for(let i=0;i<FRAG_COUNT;i++){fragments.push(makeFrag(true));}
fragments.sort((a,b)=>a.depth-b.depth);}
function makeFrag(randomX){const text=CODE_SNIPPETS[Math.floor(Math.random()*CODE_SNIPPETS.length)];const depth=Math.random();const size=10+depth*18;const color=getColor(text);return{text,x:randomX?Math.random()*W:-150-Math.random()*400,y:30+Math.random()*(H-60),speed:0.12+depth*0.55,yDrift:(Math.random()-0.5)*0.15,size,depth,color,opacity:0,maxOpacity:0.04+depth*0.35,fadeIn:true,fadeSpeed:0.002+Math.random()*0.003,rotY:Math.random()*Math.PI*2,rotSpeed:(Math.random()-0.5)*0.012,bobOffset:Math.random()*Math.PI*2,bobSpeed:0.005+Math.random()*0.01,bobAmp:0.3+Math.random()*0.6,glowPhase:Math.random()*Math.PI*2,glowSpeed:0.008+Math.random()*0.015,};}
function drawFrag(f,t){if(f.opacity<=0)return;const scaleX=Math.cos(f.rotY);if(Math.abs(scaleX)<0.08)return;const{r,g,b}=f.color;const glowPulse=0.6+0.4*Math.sin(t*f.glowSpeed+f.glowPhase);ctx.save();ctx.globalAlpha=f.opacity*Math.abs(scaleX);const bobY=Math.sin(t*f.bobSpeed+f.bobOffset)*f.bobAmp;ctx.translate(f.x,f.y+bobY);ctx.scale(scaleX,1);const skew=(1-f.depth)*0.05*Math.sin(f.rotY);ctx.transform(1,skew,0,1,0,0);ctx.font=`${f.size}px 'JetBrains Mono', 'Courier New', monospace`;const brightness=0.6+f.depth*0.4;ctx.fillStyle=`rgba(${Math.round(r * brightness)},${Math.round(g * brightness)},${Math.round(b * brightness)},1)`;ctx.fillText(f.text,0,0);ctx.restore();}
function update(){for(let i=0;i<fragments.length;i++){const f=fragments[i];f.x+=f.speed;f.y+=f.yDrift;f.rotY+=f.rotSpeed;if(f.fadeIn){f.opacity+=f.fadeSpeed;if(f.opacity>=f.maxOpacity){f.opacity=f.maxOpacity;f.fadeIn=false;}}else{if(f.x>W*0.85){const fadeZone=W*0.15;const progress=(f.x-W*0.85)/fadeZone;f.opacity=f.maxOpacity*(1-progress);if(f.opacity<=0)f.opacity=0;}}
if(f.x>W+100||(f.opacity<=0&&!f.fadeIn&&f.x>W*0.8)){fragments[i]=makeFrag(false);}}}
function render(t){if(!running)return;if(t-lastFrame<FRAME_MS){animId=requestAnimationFrame(render);return;}
lastFrame=t;ctx.clearRect(0,0,W,H);for(const f of fragments){drawFrag(f,t);}
update();animId=requestAnimationFrame(render);}
function start(){if(running)return;running=true;resize();if(!fragments)createFragments();lastFrame=0;animId=requestAnimationFrame(render);}
function stop(){running=false;if(animId)cancelAnimationFrame(animId);}
document.addEventListener('section-revealed',(e)=>{if(e.detail.index===3)start();else stop();});window.addEventListener('resize',()=>{if(running){resize();fragments=null;createFragments();}});window.faqPanels={start,stop};})();
