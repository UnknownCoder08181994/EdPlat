(function(){const canvas=document.getElementById('faq-constellation');if(!canvas)return;const ctx=canvas.getContext('2d');let width,height,nodes,animId,running=false;const NODE_COUNT=65;const CONNECT_DIST=180;const CONNECT_DIST2=CONNECT_DIST*CONNECT_DIST;const MOUSE_RADIUS=200;const MOUSE_RADIUS2=MOUSE_RADIUS*MOUSE_RADIUS;let mouse={x:-9999,y:-9999};const FRAME_MS=42;let lastFrame=0;const COLORS=[{r:139,g:92,b:246},{r:34,g:211,b:238},{r:96,g:165,b:250},{r:244,g:114,b:182},{r:167,g:139,b:250},];function resize(){width=canvas.width=window.innerWidth;height=canvas.height=window.innerHeight;}
function createNodes(){nodes=[];for(let i=0;i<NODE_COUNT;i++){const color=COLORS[Math.floor(Math.random()*COLORS.length)];nodes.push({x:Math.random()*width,y:Math.random()*height,vx:(Math.random()-0.5)*0.4,vy:(Math.random()-0.5)*0.4,radius:Math.random()*2+1,color,pulseOffset:Math.random()*Math.PI*2,pulseSpeed:0.01+Math.random()*0.02,});}}
function drawNode(node,t){const pulse=0.5+0.5*Math.sin(t*node.pulseSpeed+node.pulseOffset);const{r,g,b}=node.color;const glowRadius=node.radius+pulse*6;const grad=ctx.createRadialGradient(node.x,node.y,0,node.x,node.y,glowRadius);grad.addColorStop(0,`rgba(${r},${g},${b},${0.6 + pulse * 0.3})`);grad.addColorStop(0.4,`rgba(${r},${g},${b},${0.15 + pulse * 0.1})`);grad.addColorStop(1,`rgba(${r},${g},${b},0)`);ctx.beginPath();ctx.arc(node.x,node.y,glowRadius,0,Math.PI*2);ctx.fillStyle=grad;ctx.fill();ctx.beginPath();ctx.arc(node.x,node.y,node.radius,0,Math.PI*2);ctx.fillStyle=`rgba(${r},${g},${b},${0.8 + pulse * 0.2})`;ctx.fill();}
function drawConnections(t){for(let i=0;i<nodes.length;i++){for(let j=i+1;j<nodes.length;j++){const dx=nodes[i].x-nodes[j].x;const dy=nodes[i].y-nodes[j].y;const d2=dx*dx+dy*dy;if(d2<CONNECT_DIST2){const ratio=d2/CONNECT_DIST2;const opacity=(1-Math.sqrt(ratio))*0.25;const{r:r1,g:g1,b:b1}=nodes[i].color;const{r:r2,g:g2,b:b2}=nodes[j].color;const shimmer=0.5+0.5*Math.sin(t*0.003+i+j);const alpha=opacity*(0.5+shimmer*0.5);const mr=((r1+r2)>>1);const mg=((g1+g2)>>1);const mb=((b1+b2)>>1);ctx.beginPath();ctx.moveTo(nodes[i].x,nodes[i].y);ctx.lineTo(nodes[j].x,nodes[j].y);ctx.strokeStyle=`rgba(${mr},${mg},${mb},${alpha})`;ctx.lineWidth=0.5+(1-Math.sqrt(ratio))*0.8;ctx.stroke();}}}
for(let i=0;i<nodes.length;i++){const dx=nodes[i].x-mouse.x;const dy=nodes[i].y-mouse.y;const d2=dx*dx+dy*dy;if(d2<MOUSE_RADIUS2){const dist=Math.sqrt(d2);const opacity=(1-dist/MOUSE_RADIUS)*0.35;const{r,g,b}=nodes[i].color;ctx.beginPath();ctx.moveTo(nodes[i].x,nodes[i].y);ctx.lineTo(mouse.x,mouse.y);ctx.strokeStyle=`rgba(${r},${g},${b},${opacity})`;ctx.lineWidth=0.6;ctx.stroke();}}}
function update(){for(const node of nodes){node.x+=node.vx;node.y+=node.vy;const dx=node.x-mouse.x;const dy=node.y-mouse.y;const d2=dx*dx+dy*dy;if(d2<MOUSE_RADIUS2&&d2>0){const dist=Math.sqrt(d2);const force=(1-dist/MOUSE_RADIUS)*0.02;node.vx+=(dx/dist)*force;node.vy+=(dy/dist)*force;}
node.vx*=0.999;node.vy*=0.999;if(node.x<-20)node.x=width+20;if(node.x>width+20)node.x=-20;if(node.y<-20)node.y=height+20;if(node.y>height+20)node.y=-20;}}
function render(t){if(!running)return;if(t-lastFrame<FRAME_MS){animId=requestAnimationFrame(render);return;}
lastFrame=t;ctx.clearRect(0,0,width,height);drawConnections(t);for(const node of nodes){drawNode(node,t);}
update();animId=requestAnimationFrame(render);}
function start(){if(running)return;running=true;resize();if(!nodes||nodes.length===0)createNodes();lastFrame=0;animId=requestAnimationFrame(render);}
function stop(){running=false;if(animId)cancelAnimationFrame(animId);}
const faqSection=document.getElementById('faq');if(faqSection){faqSection.addEventListener('mousemove',(e)=>{mouse.x=e.clientX;mouse.y=e.clientY;});faqSection.addEventListener('mouseleave',()=>{mouse.x=-9999;mouse.y=-9999;});}
document.addEventListener('section-revealed',(e)=>{if(e.detail.index===3){start();}else{stop();}});window.addEventListener('resize',()=>{if(running){resize();}});window.faqConstellation={start,stop};})();
