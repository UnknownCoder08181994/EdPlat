class ModulesCatalogue{constructor(){this.grid=document.getElementById('catalogue-grid');this.cards=Array.from(this.grid.querySelectorAll('.course-card'));this.pills=Array.from(document.querySelectorAll('.filter-pill'));this.searchInput=document.getElementById('toolbar-search');this.countEl=document.getElementById('toolbar-count');this.emptyEl=document.getElementById('catalogue-empty');this.activeFilter='all';this.searchTerm='';this.activeTopic='';this.debounceTimer=null;this.dropdown=document.getElementById('toolbar-topic-dropdown');this.dropdownBtn=document.getElementById('toolbar-topic-btn');this.dropdownMenu=document.getElementById('toolbar-topic-menu');this.dropdownLabel=this.dropdownBtn.querySelector('.toolbar-dropdown-label');this.dropdownItems=Array.from(this.dropdownMenu.querySelectorAll('.toolbar-dropdown-item'));this.bindEvents();this.render();}
bindEvents(){this.pills.forEach(pill=>{pill.addEventListener('click',()=>{this.pills.forEach(p=>p.classList.remove('active'));pill.classList.add('active');this.activeFilter=pill.dataset.filter;this.render();});});this.searchInput.addEventListener('input',()=>{clearTimeout(this.debounceTimer);this.debounceTimer=setTimeout(()=>{this.searchTerm=this.searchInput.value.trim().toLowerCase();this.render();},200);});this.dropdownBtn.addEventListener('click',(e)=>{e.stopPropagation();this.dropdown.classList.toggle('open');});this.dropdownItems.forEach(item=>{item.addEventListener('click',(e)=>{e.stopPropagation();this.dropdownItems.forEach(i=>i.classList.remove('active'));item.classList.add('active');this.activeTopic=item.dataset.value;this.dropdownLabel.textContent=item.textContent;this.dropdown.classList.remove('open');this.render();});});document.addEventListener('click',()=>{this.dropdown.classList.remove('open');});document.querySelectorAll('.course-start-btn').forEach(btn=>{btn.addEventListener('click',(e)=>{e.stopPropagation();var slug=btn.closest('.course-card').dataset.slug;if(slug)window.location.href='/modules/'+slug;});});}
render(){var visible=0;this.cards.forEach(card=>{var tags=card.dataset.tags||'';var title=card.querySelector('.course-card-title').textContent.toLowerCase();var desc=card.querySelector('.course-card-desc').textContent.toLowerCase();var show=true;if(this.activeFilter!=='all'){if(!tags.includes(this.activeFilter)){show=false;}}
if(this.activeTopic&&show){if(!tags.includes(this.activeTopic)){show=false;}}
if(this.searchTerm&&show){if(!title.includes(this.searchTerm)&&!desc.includes(this.searchTerm)){show=false;}}
card.style.display=show?'':'none';if(show)visible++;});this.countEl.textContent=visible+(visible===1?' Module':' Modules');if(visible===0){this.emptyEl.classList.add('visible');}else{this.emptyEl.classList.remove('visible');}}}
document.addEventListener('DOMContentLoaded',()=>{new ModulesCatalogue();});